# ===================================
# EXPLOIT DETECTION RULES
# Total: 19 rules (SID 1000501-1000519)
# ===================================

# Remote Code Execution (RCE)
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RCE eval() Function Detected"; flow:established,to_server; content:"eval("; nocase; classtype:web-application-attack; sid:1000501; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RCE system() Command Execution"; flow:established,to_server; content:"system("; nocase; classtype:web-application-attack; sid:1000502; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RCE exec() Function"; flow:established,to_server; content:"exec("; nocase; classtype:web-application-attack; sid:1000503; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RCE passthru() Function"; flow:established,to_server; content:"passthru("; nocase; classtype:web-application-attack; sid:1000504; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RCE shell_exec() Function"; flow:established,to_server; content:"shell_exec("; nocase; classtype:web-application-attack; sid:1000505; rev:1;)

# Command Injection
# alert tcp any any -> $HOME_NET any (msg:"EXPLOIT Command Injection with Pipe"; flow:established,to_server; pcre:"/[;|&]\s*(ls|cat|wget|curl|nc|bash|sh)/i"; classtype:web-application-attack; sid:1000511; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT Command Injection Backticks"; flow:established,to_server; content:"`"; http_uri; classtype:web-application-attack; sid:1000512; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT Command Injection with $()"; flow:established,to_server; content:"$("; http_uri; classtype:web-application-attack; sid:1000513; rev:1;)

# Local File Inclusion (LFI)
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT LFI Directory Traversal ../"; flow:established,to_server; content:"../"; http_uri; classtype:web-application-attack; sid:1000516; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT LFI /etc/passwd Access"; flow:established,to_server; content:"/etc/passwd"; http_uri; nocase; classtype:web-application-attack; sid:1000517; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT LFI /etc/shadow Access"; flow:established,to_server; content:"/etc/shadow"; http_uri; nocase; classtype:web-application-attack; sid:1000518; rev:1;)

# Remote File Inclusion (RFI)
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RFI HTTP Include Attempt"; flow:established,to_server; content:"http://"; http_uri; pcre:"/(\?|&)(page|file|include|path)=/i"; classtype:web-application-attack; sid:1000519; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT RFI HTTPS Include Attempt"; flow:established,to_server; content:"https://"; http_uri; pcre:"/(\?|&)(page|file|include)=/i"; classtype:web-application-attack; sid:1000520; rev:1;)

# Cross-Site Scripting (XSS)
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT XSS <script> Tag Detected"; flow:established,to_server; content:"<script"; http_uri; nocase; classtype:web-application-attack; sid:1000521; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT XSS javascript: Protocol"; flow:established,to_server; content:"javascript:"; http_uri; nocase; classtype:web-application-attack; sid:1000522; rev:1;)

alert tcp any any -> $HOME_NET any (msg:"EXPLOIT XSS onerror Event Handler"; flow:established,to_server; content:"onerror="; http_uri; nocase; classtype:web-application-attack; sid:1000523; rev:1;)

# Log4Shell (CVE-2021-44228)
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT Log4Shell JNDI Injection Attempt"; flow:established,to_server; content:"${jndi:"; nocase; classtype:attempted-admin; sid:1000531; rev:1;)

# Shellshock (CVE-2014-6271)
# alert tcp any any -> $HOME_NET any (msg:"EXPLOIT Shellshock Bash Function Detected"; flow:established,to_server; content:"() {"; content:":;};"; distance:0; classtype:attempted-admin; sid:1000532; rev:1;)

# WebShell Detection
alert tcp any any -> $HOME_NET any (msg:"EXPLOIT WebShell c99 Detected"; flow:established,to_server; content:"c99shell"; nocase; classtype:web-application-attack; sid:1000541; rev:1;)
